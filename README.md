# Сервер с внутренней очередью для фоновой обработки входящих задач
Этот сервер имеет 2 эндпоинта: /enqueue и /healthz и работает на порту :8080. /healthz - просто отдает код 200. А вот /enqueue имеет более сложную логику. Сперва идет обработка входящего json через controller и декодирование его в Task модель. Далее происходит валидация данных и задача посылается в очередь.

С другой стороны этой очереди (буферизированного канала) находятся worker-ы, которые как раз и обрабатывают эти задачи. Благодаря паттерну worker pool горутины не уничтожаются даже, если очередь пустая => не тратятся ресурсы на создание новых и удаление старых. Функция HandleWorker отвечает за корректную работу воркера при shutdown, а также проверяет очередь на наличие новых задач. В функции HandleTask происходит основая логика обработки задачи. Сначала имитируется выполнение (от 100 до 500 мс) и имитация возникновения ошибок. 
Статус задач обновляется в ходе всего пути, от контролера до воркеров. Cтатусы сделаны при помощи enum, а точнее iota. 

При SIGINT/SIGTERM происходит закрытие канала shutdown, который обозначает, что сервер скоро завершит свою работу. При запросе к контролеру enqueue выдается ошибка 503, т.к мы уже получили уведомление о закрытии канала shutdown. А воркеры тоже получив это уведомление завершают работу всех задач в очереди и благополучно делают wg.Done => когда wg.Wait получит, что все горутины завершились, то программа завершит свое выполнение, не потеряв ни одной задачи.  
